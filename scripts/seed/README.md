# GameTrade Seed Scripts

Этот каталог содержит скрипты для заполнения баз данных сервисов тестовыми данными.

## Способы заполнения данными

В проекте реализовано два подхода к созданию тестовых данных:

### 1. Прямой доступ к базе данных (Legacy)

Эти скрипты создают тестовые данные путем прямого добавления записей в базы данных сервисов:

- `auth_seed.py` - создает пользователей, роли и профили в auth-svc
- `marketplace_seed.py` - создает объявления в marketplace-svc
- `payment_seed.py` - создает кошельки, транзакции и продажи в payment-svc
- `run-seed.sh` - запускает все скрипты последовательно в Docker

**Использование:**
```bash
# Запуск всех скриптов
bash scripts/seed/run-seed.sh

# Запуск отдельного скрипта (например, auth_seed.py)
docker-compose exec auth-svc python /app/scripts/auth_seed.py
```

### 2. Эмуляция реальных API запросов (Рекомендуется)

Эти скрипты эмулируют поведение реальных клиентов, создавая данные через API эндпоинты:

- `auth_emulator.py` - регистрирует пользователей через эндпоинты регистрации и обновляет профили
- `marketplace_emulator.py` - создает объявления через API marketplace-svc
- `payment_emulator.py` - создает кошельки, пополняет их и создает продажи через API payment-svc
- `run-emulate.sh` - запускает все эмуляторы последовательно в Docker

**Использование:**
```bash
# Запуск всех эмуляторов
bash scripts/seed/run-emulate.sh

# Запуск отдельного эмулятора (например, auth_emulator.py)
docker-compose exec auth-svc python /app/scripts/auth_emulator.py
```

## Преимущества использования эмуляторов API

1. **Реалистичные сценарии**: Эмуляторы имитируют поведение реальных пользователей
2. **Проверка бизнес-логики**: Проходят через все слои приложения, включая валидации и бизнес-логику
3. **Тестирование API**: Позволяют обнаружить проблемы с API эндпоинтами
4. **Безопасность**: Не требуют прямого доступа к базам данных
5. **Тестирование авторизации**: Проверяют работу токенов и разграничение доступа

## Структура данных

Все скрипты создают экспортные файлы в директории `scripts/seed/data/`:

- `auth_seed_data.json` - данные пользователей и их токены
- `marketplace_seed_data.json` - данные созданных объявлений
- `payment_seed_data.json` - данные кошельков и продаж

Эти файлы используются для обмена данными между сервисами (например, ID пользователей для создания объявлений).

## Тестовые пользователи

| Email | Пароль | Роль |
|-------|--------|------|
| admin@gametrade.com | admin123 | Администратор |
| alice@example.com | password123 | Пользователь |
| bob@example.com | password123 | Пользователь |
| charlie@example.com | password123 | Пользователь |
| ... | ... | ... |

## Примечания

- Скрипты имеют идемпотентность (можно запускать многократно без дублирования)
- Требуется запущенные сервисы в Docker (docker-compose up -d)
- Для работы эмуляторов требуется доступ к API через Nginx (http://localhost/api/...)

## Устранение проблем

При возникновении ошибок:

1. Убедитесь, что все сервисы запущены (`docker-compose ps`)
2. Проверьте логи сервисов (`docker-compose logs -f auth-svc`)
3. Для эмуляторов убедитесь, что API доступно (`curl http://localhost/api/health`)
4. Убедитесь, что в контейнерах установлен пакет `requests` (`docker-compose exec auth-svc pip install requests`) 